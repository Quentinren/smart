<div class="stock-conduite-container">
  <div class="section-header">
    <h1 class="section-title">Stock en conduite projeté</h1>
  </div>
  
  <div class="info-banner">
    <div class="info-icon">
      <mat-icon>info</mat-icon>
    </div>
    <div class="info-message">
      Les données affichées sont mises à jour toutes les 30 minutes. Dernière mise à jour : {{ lastUpdate }}
    </div>
  </div>
  
  <div class="controls-section">
    <div class="date-controls">
      <mat-form-field appearance="outline">
        <mat-label>Période</mat-label>
        <mat-date-range-input [formGroup]="dateRange" [rangePicker]="picker">
          <input matStartDate formControlName="start" placeholder="Date début">
          <input matEndDate formControlName="end" placeholder="Date fin">
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker></mat-date-range-picker>
      </mat-form-field>
      
      <button mat-raised-button color="primary" (click)="refreshData()">
        <mat-icon>refresh</mat-icon>
        Actualiser
      </button>
    </div>
    
    <div class="current-stats">
      <div class="stats-container">
        <div class="stats-label">État actuel</div>
        <div class="stats-values">
          <div class="stats-item">
            <div class="stats-title">Valeur actuelle</div>
            <div class="stats-value">{{ currentValue.toFixed(2) }} GWh</div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Heure</div>
            <div class="stats-value">{{ currentTime }}</div>
          </div>
          <div class="status-tag">
            <div class="status-indicator" [ngClass]="equilibriumStatus.toLowerCase()">
              {{ equilibriumStatus }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="chart-container">
    <svg [attr.width]="chartWidth" [attr.height]="chartHeight" viewBox="0 0 900 400" preserveAspectRatio="xMidYMid meet">
      <!-- Background zones -->
      <g *ngFor="let zone of zones">
        <rect
          x="0"
          [attr.y]="getZoneY(zone)"
          [attr.width]="chartWidth"
          [attr.height]="getZoneHeight(zone)"
          [attr.fill]="zone.color"
          opacity="0.3"
        />
        <text
          x="10"
          [attr.y]="getZoneY(zone) + getZoneHeight(zone) / 2"
          class="zone-label"
        >{{ zone.name }}</text>
      </g>
      
      <!-- Grid lines -->
      <g *ngFor="let value of [2600, 2700, 2800, 2900, 3000, 3100]">
        <line
          x1="0"
          [attr.y1]="getYPosition(value)"
          [attr.x2]="chartWidth"
          [attr.y2]="getYPosition(value)"
          class="grid-line"
        />
        <text
          x="-5"
          [attr.y]="getYPosition(value)"
          text-anchor="end"
          alignment-baseline="middle"
          class="axis-label"
        >{{ value }}</text>
      </g>
      
      <!-- X-axis labels -->
      <g *ngFor="let label of timeLabels; let i = index">
        <text
          [attr.x]="getXPosition(i)"
          [attr.y]="chartHeight + 20"
          class="axis-label"
          text-anchor="middle"
        >{{ label }}</text>
      </g>
      
      <!-- Data line -->
      <polyline
        class="data-line"
        [attr.points]="getPointsPath()"
      />
      
      <!-- Data points -->
      <g *ngFor="let point of stockData; let i = index">
        <circle
          [attr.cx]="getXPosition(i)"
          [attr.cy]="getYPosition(point.value)"
          r="4"
          class="data-point"
        />
      </g>
      
      <!-- Axis titles -->
      <text x="-60" y="200" class="axis-title" transform="rotate(-90, -60, 200)">Stock en GWh</text>
      <text x="450" y="430" class="axis-title">Heure</text>
    </svg>
    
    <div class="chart-legend">
      <div class="legend-item">
        <div class="legend-color tres-long"></div>
        <div class="legend-label">Très long</div>
      </div>
      <div class="legend-item">
        <div class="legend-color long"></div>
        <div class="legend-label">Long</div>
      </div>
      <div class="legend-item">
        <div class="legend-color equilibre"></div>
        <div class="legend-label">Équilibré</div>
      </div>
      <div class="legend-item">
        <div class="legend-color court"></div>
        <div class="legend-label">Court</div>
      </div>
      <div class="legend-item">
        <div class="legend-color tres-court"></div>
        <div class="legend-label">Très court</div>
      </div>
    </div>
  </div>
  
  <div class="chart-footer">
    <div class="data-source">Source: données du {{ selectedDate }}</div>
  </div>
</div>